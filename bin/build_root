#!/usr/bin/env php
<?php
use Everyman\Neo4j\Client,
	Everyman\Neo4j\Index\NodeIndex,
	Everyman\Neo4j\Relationship,
	Everyman\Neo4j\Node,
	Everyman\Neo4j\Gremlin,
	Tokenizer\Token;

include_once(dirname(__DIR__).'/library/Autoload.php');
spl_autoload_register('Autoload::autoload_library');

$client = new Client();

//
$result = query("g.idx('racines')");
if ($result[0][0] != 'MANUAL[racines:Vertex]') {
    query("g.createManualIndex('racines', Vertex)");
}
query("g.V.has('index', 'true').each{ g.idx('racines').put('token', it.token, it); };");
print "Indexing done\n";

function query($query) {
    global $client;
    $params = array('type' => 'IN');
    $query = new Gremlin\Query($client, $query, $params);
    return $query->getResultSet();
}

?>